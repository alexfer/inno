{% extends 'market_place/index.html.twig' %}
{% block title %}
    {% if categories is null %}
        {{ category.name }}
    {% else %}
        {{ 'search.form.categories'|trans }}
    {% endif %}
{% endblock %}
{% block offest %}pt-4 py-4 lg:py-2 lg:px-2{% endblock %}
{% block extra_search %}
    <div class="max-w-screen-xl flex mx-auto justify-center mt-3">
        <div class="w-full py-2.5 mx-3 px-4 border border-gray-100 rounded-lg bg-gray-50 mb-3">
            <svg class="w-3 h-3 me-2.5 inline-flex" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                <path d="m19.707 9.293-2-2-7-7a1 1 0 0 0-1.414 0l-7 7-2 2a1 1 0 0 0 1.414 1.414L2 10.414V18a2 2 0 0 0 2 2h3a1 1 0 0 0 1-1v-4a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v4a1 1 0 0 0 1 1h3a2 2 0 0 0 2-2v-7.586l.293.293a1 1 0 0 0 1.414-1.414Z"></path>
            </svg>
            <div class="inline-flex me-3">
                <a href="{{ path('app_market_place_index') }}" class="inline-flex items-center text-sm font-medium text-gray-700 hover:text-blue-600 dark:text-gray-400 dark:hover:text-white">
                    {{ 'title.market_places'|trans }}
                </a>
            </div>
            {% if categories is null %}
                <svg class="rtl:rotate-180 w-3 h-3 text-gray-400 mx-1 inline-flex me-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 6 10">
                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 9 4-4-4-4"></path>
                </svg>
                <div class="inline-flex me-3">
                    <a href="{{ path('app_market_place_category') }}" class="inline-flex items-center text-sm font-medium text-gray-700 hover:text-blue-600 dark:text-gray-400 dark:hover:text-white">
                        {{ 'search.form.categories'|trans }}
                    </a>
                </div>
            {% endif %}
            {% if app.request.get('parent') is not null %}
                <svg class="rtl:rotate-180 w-3 h-3 text-gray-400 mx-1 inline-flex me-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 6 10">
                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 9 4-4-4-4"></path>
                </svg>
                <div class="inline-flex me-3">
                    <a href="{{ path('app_market_place_parent_category', {parent: app.request.get('parent')}) }}" class="inline-flex items-center text-sm font-medium text-gray-700 hover:text-blue-600 dark:text-gray-400 dark:hover:text-white">
                        {{ parent_name }}
                    </a>
                </div>
            {% endif %}
            {% if app.request.get('child') is not null %}
                <svg class="rtl:rotate-180 w-3 h-3 text-gray-400 mx-1 inline-flex me-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 6 10">
                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 9 4-4-4-4"></path>
                </svg>
                <div class="inline-flex me-3">
                    <a href="{{ path('app_market_place_child_category', {parent: app.request.get('parent'), child: app.request.get('child')}) }}" class="inline-flex items-center text-sm font-medium text-gray-700 hover:text-blue-600 dark:text-gray-400 dark:hover:text-white">
                        {{ child_name }}
                    </a>
                </div>
            {% endif %}
            <svg class="rtl:rotate-180 w-3 h-3 text-gray-400 mx-1 inline-flex me-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 6 10">
                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 9 4-4-4-4"></path>
            </svg>
            <button id="category-filter"
                    data-dropdown-toggle="dropdown-extra"
                    data-dropdown-offset-distance="10"
                    data-dropdown-offset-skidding="30"
                    data-dropdown-placement="bottom"
                    class="inline-flex relative mb-1 w-52 px-3 py-2 text-sm font-normal text-center text-gray-900 hover:text-blue-600 bg-white rounded-lg hover:bg-gray-100 focus:ring-4 focus:outline-none focus:ring-gray-100 dark:bg-gray-900 dark:hover:bg-gray-800 dark:text-white dark:focus:ring-gray-700"
                    type="button">{{ 'option.category.choice_category'|trans }}
                <svg class="w-2.5 h-2.5 absolute end-0 me-3 mt-1 text-gray-700 hover:text-gray-700" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none"
                     viewBox="0 0 10 6">
                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="m1 1 4 4 4-4"></path>
                </svg>
            </button>
            <div id="dropdown-extra"
                 class="z-10 hidden bg-white divide-y divide-gray-100 rounded-lg shadow-lg w-auto dark:bg-gray-700">
                <ul class="my-5 ps-1.5 list-none lg:flex-row" aria-labelledby="category-filter">
                    {% if categories is null %}
                        {% set _collection = parent is not null ? parent.children : category.children %}
                    {% else %}
                        {% set _collection = categories %}
                    {% endif %}
                    {% for child in _collection %}
                        <li>
                            <a title="{{ child.name }}"
                               {% if categories is null %}
                                   href="{{ path('app_market_place_child_category', {parent: app.request.get('parent'), child: child.slug}) }}"
                               {% else %}
                                   href="{{ path('app_market_place_parent_category', {parent: child.slug}) }}"
                               {% endif %}
                               class="block mx-1 mt-1.5 w-auto text-gray-500 rounded-lg hover:text-gray-500 hover:bg-gray-100 text-sm px-5 py-2.5 me-2 mb-2 dark:border-gray-500 dark:text-gray-500 dark:hover:text-white dark:hover:bg-gray-500">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor"
                                     class="w-3.5 h-3.5 inline-block mr-1">
                                    <path fill-rule="evenodd"
                                          d="M2 8c0 .414.336.75.75.75h8.69l-1.22 1.22a.75.75 0 1 0 1.06 1.06l2.5-2.5a.75.75 0 0 0 0-1.06l-2.5-2.5a.75.75 0 1 0-1.06 1.06l1.22 1.22H2.75A.75.75 0 0 0 2 8Z"
                                          clip-rule="evenodd"></path>
                                </svg>{{ child.name }}
                            </a>
                        </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>
{% endblock %}
{% block content_body %}
    <h2 class="text-2xl pb-4 font-oswald font-extrabold text-primary-700 dark:text-white">
        {% if categories is null %}
            {{ category.name }}
        {% else %}
            {{ 'search.form.categories'|trans }}
        {% endif %}
    </h2>
    <div class="grid w-full gap-3 lg:grid-cols-3 md:grid-cols-2">
        {% for product in products %}
            {% set product = product.product %}
            <div class="min-h-full">
                <div class="max-w-sm bg-white border border-gray-200 rounded-lg shadow dark:bg-gray-800 dark:border-gray-700">
                    <div class="lg:max-w-xl relative overflow-hidden bg-cover bg-no-repeat">
                        {% if product.attach_name %}
                            {% set _picture = 'storage/product/' ~ product.id ~ '/' ~ product.attach_name %}
                            <img src="{{ asset(_picture)|imagine_filter('product_preview') }}"
                                 class="object-cover w-full transition duration-300 ease-in-out hover:scale-125 hover:inset-1/2 rounded-t-lg"
                                 alt="{{ product.name }}">
                        {% else %}
                            <img src="{{ asset('img/300x200.png') }}"
                                 class="object-cover w-full transition duration-300 ease-in-out hover:scale-125 hover:inset-1/2 rounded-t-lg"
                                 alt="{{ product.name }}">
                        {% endif %}
                        <div class="absolute top-5 w-full">
                            <div class="flex justify-between">
                                <span class="ml-2 bg-gray-600 bg-opacity-90 text-gray-500 text-md shadow-xl font-medium me-2 px-2.5 py-0.5 rounded-md dark:bg-gray-900 dark:text-gray-300">
                                    <a title="{{ product.name }}"
                                       href="{{ path('app_market_place_product', {slug: product.slug, tab: 'about'}) }}"
                                       class="text-white hover:text-neutral-100 hover:animate-pulse">{{ 'store.product.details'|trans }}
                                    </a>
                                </span>
                                {% if product.discount %}
                                    <span class="bg-red-700 bg-opacity-75 text-white text-md font-medium me-2 px-2.5 py-0.5 rounded-xl dark:bg-red-900 dark:text-white">{{ product.discount }}% {{ 'store.product.off'|trans }}</span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    <div class="flex items-center py-4 justify-between">
                        <div class="ml-3">
                            <form class="shopping-cart" method="post"
                                  action="{{ path('app_market_place_product_order', {product: product.slug}) }}">
                                <button class="text-white bg-gray-800 shadow-md hover:bg-surface-dark focus:ring-2 focus:outline-none focus:ring-gray-300 font-medium rounded-md text-sm px-4 py-1.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800"
                                        data-slug="{{ product.slug }}" type="submit"
                                        {% if product.quantity == 0 or (app.user and ('ROLE_USER' in app.user.roles or 'ROLE_ADMIN' in app.user.roles)) %}disabled{% endif %}>
                                    <i class="fa fa-shopping-cart mt-1 me-2"></i>{{ 'store.product.add'|trans }}
                                </button>
                            </form>
                        </div>
                        <div class="mr-3">
                            {% set discount = product.discount %}
                            {% set cost = product.cost + product.fee %}
                            {% set discount_cost = (cost - ((cost * discount) - discount)/100) %}
                            <span class="text-2xl font-medium {% if discount > 0 %}text-rose-500{% else %}text-gray-900{% endif %} dark:text-white">{{ (discount_cost)|amount_format }}<small>{{ product.currency|currency }}</small></span>
                        </div>
                    </div>
                    {% if product.parent_category_name is not null %}
                        <a title="{{ product.name }}" class="mt-3"
                           href="{{ path('app_market_place_product', {slug: product.slug, tab: 'about'}) }}">
                            <h5 class="mx-3 mb-2 text-lg font-bold hover:text-gray-700 tracking-tight truncate text-gray-500 dark:text-white">
                                {{ product.short_name }}
                            </h5>
                        </a>
                    {% else %}
                        <a href="{{ path('app_market_place_parent_category', {parent:  product.parent_category_slug}) }}"
                           class="hover:underline truncate ml-2 text-gray-500 w-full block">
                            <i class="fa fa-check px-2 text-green-400"></i>{{ product.parent_category_name }}
                        </a>
                    {% endif %}
                    {% if categories is null %}
                        <a href="{{ path('app_market_place_child_category', {
                            parent: product.parent_category_slug,
                            child:  product.category_slug
                        }) }}" title="{{ product.category_name }}"
                           class="hover:underline hover:w-full truncate block w-auto ml-2 mr-3 text-gray-500">
                            <i class="fa fa-check px-2 text-green-400"></i>{{ product.category_name }}
                        </a>
                    {% else %}
                        <a href="{{ path('app_market_place_parent_category', {parent:  product.parent_category_slug}) }}"
                           class="hover:underline truncate ml-2 text-gray-500 w-full block">
                            <i class="fa fa-check px-2 text-green-400"></i>{{ product.parent_category_name }}
                        </a>
                        <a href="{{ path('app_market_place_child_category', {
                            parent: product.parent_category_slug,
                            child:  product.category_slug
                        }) }}" title="{{ product.category_name }}"
                           class="hover:underline hover:w-full truncate block w-auto ml-2 mr-3 text-gray-500">
                            <i class="fa fa-check px-2 text-green-400"></i>{{ product.category_name }}
                        </a>
                    {% endif %}
                    <ul class="list-none ml-2 mt-6">
                        <li class="pb-0 flex">
                            <a class="hover:text-indigo-600 text-blue-600 hover:animate-pulse"
                               href="{{ path('app_market_place_product', {slug: product.slug, tab: 'tabs-contact'}) }}#product-ifo-ref">
                                <i class="fa fa-comment mx-2 text-indigo-700"></i>{{ 'label.form.message'|trans }}
                            </a>
                        </li>
                        <li class="pb-0 flex">
                            <a class="truncate inline-block w-64 hover:fill-sky-600 hover:animate-pulse"
                               href="{{ path('app_market_place_market', {slug:  product.store_slug}) }}">
                                <svg class="w-4 h-4 mx-2 fill-red-700 inline-block"
                                     xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                                    <path d="M256 96c38.4 0 73.7 13.5 101.3 36.1l-32.6 32.6c-4.6 4.6-5.9 11.5-3.5 17.4s8.3 9.9 14.8 9.9H448c8.8 0 16-7.2 16-16V64c0-6.5-3.9-12.3-9.9-14.8s-12.9-1.1-17.4 3.5l-34 34C363.4 52.6 312.1 32 256 32c-10.9 0-21.5 .8-32 2.3V99.2c10.3-2.1 21-3.2 32-3.2zM132.1 154.7l32.6 32.6c4.6 4.6 11.5 5.9 17.4 3.5s9.9-8.3 9.9-14.8V64c0-8.8-7.2-16-16-16H64c-6.5 0-12.3 3.9-14.8 9.9s-1.1 12.9 3.5 17.4l34 34C52.6 148.6 32 199.9 32 256c0 10.9 .8 21.5 2.3 32H99.2c-2.1-10.3-3.2-21-3.2-32c0-38.4 13.5-73.7 36.1-101.3zM477.7 224H412.8c2.1 10.3 3.2 21 3.2 32c0 38.4-13.5 73.7-36.1 101.3l-32.6-32.6c-4.6-4.6-11.5-5.9-17.4-3.5s-9.9 8.3-9.9 14.8V448c0 8.8 7.2 16 16 16H448c6.5 0 12.3-3.9 14.8-9.9s1.1-12.9-3.5-17.4l-34-34C459.4 363.4 480 312.1 480 256c0-10.9-.8-21.5-2.3-32zM256 416c-38.4 0-73.7-13.5-101.3-36.1l32.6-32.6c4.6-4.6 5.9-11.5 3.5-17.4s-8.3-9.9-14.8-9.9H64c-8.8 0-16 7.2-16 16l0 112c0 6.5 3.9 12.3 9.9 14.8s12.9 1.1 17.4-3.5l34-34C148.6 459.4 199.9 480 256 480c10.9 0 21.5-.8 32-2.3V412.8c-10.3 2.1-21 3.2-32 3.2z"></path>
                                </svg>{{ product.store }}
                            </a>
                        </li>
                        {% if product.store_phone %}
                            <li class="pb-0 flex">
                                <a href="tel:{{ product.store_phone }}"
                                   class="text-green-700 hover:text-green-800 hover:animate-pulse">
                                    <i class="fa fa-phone-square text-green-700 mx-2"></i>{{ product.store_phone }}
                                </a>
                            </li>
                        {% endif %}
                    </ul>
                    <div class="flex items-center border-t mt-3 pt-3 bg-gray-50 bg-opacity-75 pb-3 px-3 justify-between">
                        <div>
                            <a href="{{ path('app_market_place_product', {slug: product.slug, tab: 'about'}) }}"
                               class="hover:text-violet-500 text-md  hover:text-decoration-underline hover:animate-pulse">{{ 'store.product.details'|trans }}
                                <svg class="w-[16px] h-[16px] inline ml-3 fill-primary-500 hover:fill-violet-600 hover:scale-110"
                                     viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M502.6 278.6c12.5-12.5 12.5-32.8 0-45.3l-128-128c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L402.7 224 32 224c-17.7 0-32 14.3-32 32s14.3 32 32 32l370.7 0-73.4 73.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l128-128z"></path>
                                </svg>
                            </a>
                        </div>
                        <div>
                            <form class="add-wishlist" name="wishlist"
                                  action="{{ path('app_market_place_add_wishlist', {slug: product.slug}) }}">
                                <input name="market" type="hidden" value="{{ product.store_id }}">
                                {% include 'market_place/wishlist.html.twig' with {'extra': null} %}
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>
    {% if products|length == 0 %}
        <div class="w-full">
            <img class="mx-auto"
                 src="{{ asset('img/404.png') }}"
                 width="340" alt="{{ 'table.footer.not_found'|trans }}">
        </div>
        <div class="w-full mt-5 text-gray-600 dark:text-white text-center">
            {{ 'table.footer.not_found'|trans }}
            <a class="block w-full hover:text-blue-800 hover:underline dark:text-white"
               href="{{ path('app_market_place_index') }}">{{ 'form.action.back'|trans }}</a>
        </div>
    {% endif %}
{% endblock %}